<% content_for :title do %>
  <%= @dream.title %>
<% end %>
<h1> <%= @dream.title %> </h1>

<% @dream.tags.each do |tag| %>
  <span class="badge text-bg-info"><%= tag.name %></span>
<% end %>

<%= image_tag @dream.image, class: 'img-fluid', width: '300px' if @dream.image.attached? %>
<p> <%= @dream.description %> </p>
<%= link_to 'Edit', edit_dream_path(@dream), class: 'btn btn-secondary' %>

<div data-controller="comment-form">
  <button data-action="click->comment-form#toggle" data-comment-form-target="toggle" class="btn btn-primary">Add Comment</button>
  <div data-comment-form-target="form">
    <%= render 'comment_form' %>
  </div>
</div>

<% @comments.includes(:user, :subcomments).order(created_at: :desc).each do |comment| %>
  <div class="card mb-1">
    <div class="card-body">
      <h5 class="card-title"><%= comment.user.email %></h5>
      <p class="card-text"><%= comment.body %></p>
      <div data-controller="comment-form">
        <button data-action="click->comment-form#toggle" data-comment-form-target="toggle" class="btn btn-secondary btn-sm">Reply</button>
        <div data-comment-form-target="form">
          <%= render 'comment_form', parent_id: comment.id %>
        </div>
      </div>
    </div>
    <% if comment.subcomments.any? %>
      <div class="ms-5">
        <% comment.subcomments.each do |subcomment| %>
          <div class="mb-0 border-top">
            <div class="card-body">
              <h5 class="card-title"><%= subcomment.user.email %></h5>
              <p class="card-text"><%= subcomment.body %></p>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
<% end %>
